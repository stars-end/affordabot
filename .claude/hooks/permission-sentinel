#!/bin/bash
# pre-commit hook - Block commits to canonical repos

GIT_DIR=$(git rev-parse --git-dir 2>/dev/null || echo "")

# Allow commits in worktrees
if [[ "$GIT_DIR" =~ worktrees ]]; then
    exit 0
fi

# Block commits in canonical repos
cat <<EOF

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ðŸš¨ COMMIT BLOCKED: Canonical Repository                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This is a canonical repository that resets to origin/master
daily at 3am. Commits here will be lost.

Use worktrees for all development work:
  dx-worktree create bd-xxxx $(basename $(git rev-parse --show-toplevel))
  cd /tmp/agents/bd-xxxx/$(basename $(git rev-parse --show-toplevel))

Then commit there instead.

To bypass (testing only): git commit --no-verify

EOF
exit 1
