# Glass Box Observability Spec (`affordabot-4dc`)

## Objective
Provide "World-Class" transparency into the RAG pipeline. Admins must see the exact data flow from Raw Scrape to LLM Output.

## Visual Trace Requirements
The "Analysis Lab" result modal must show a timeline/stepper:
1.  **Raw Input**: Link to `RawScrape` asset (HTML/JSON).
2.  **Processing**: Show chunking stats (e.g., "Generated 15 chunks").
3.  **Retrieval**:
    *   Show the *exact* search query generated by the agent.
    *   Show the Top-K retrieved chunks with their similarity scores.
    *   *New*: Accordion to expand/collapse chunk text.
4.  **Generation**:
    *   Show the full System Prompt (versioned).
    *   Show the full User Prompt (with injected context).
    *   Show Token Usage (Input/Output/Total).
5.  **Output**: The final JSON response.

## Control Features
*   **Override**: Button to "Edit & Retry" at the Prompt stage.
*   **Re-Rank**: Ability to manually discard retrieved chunks before Generation.

## Verification
*   **E2E Test**: `tests/e2e/glass_box.spec.ts`
    *   Run an analysis.
    *   Open result modal.
    *   Assert visibility of Query, Chunks, Prompt, and Tokens.
